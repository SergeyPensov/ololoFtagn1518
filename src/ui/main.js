//var problem = '';
//p3
var problem = '{"height":20,"width":30,"sourceSeeds":[0,29060,6876,31960,6094],"units":[{"members":[{"x":0,"y":0},{"x":2,"y":0}],"pivot":{"x":1,"y":0}},{"members":[{"x":1,"y":0},{"x":0,"y":1},{"x":0,"y":2}],"pivot":{"x":0,"y":1}},{"members":[{"x":2,"y":0},{"x":1,"y":0},{"x":0,"y":1}],"pivot":{"x":1,"y":0}},{"members":[{"x":1,"y":1},{"x":1,"y":0},{"x":0,"y":1}],"pivot":{"x":0,"y":0}},{"members":[{"x":2,"y":0},{"x":1,"y":1},{"x":1,"y":2},{"x":0,"y":3}],"pivot":{"x":1,"y":1}},{"members":[{"x":2,"y":0},{"x":1,"y":0},{"x":0,"y":1},{"x":0,"y":2}],"pivot":{"x":1,"y":1}},{"members":[{"x":1,"y":1},{"x":1,"y":0},{"x":0,"y":1},{"x":0,"y":2}],"pivot":{"x":0,"y":1}},{"members":[{"x":0,"y":0},{"x":1,"y":0},{"x":0,"y":1},{"x":0,"y":2}],"pivot":{"x":0,"y":1}},{"members":[{"x":1,"y":0},{"x":1,"y":1},{"x":1,"y":2},{"x":0,"y":3}],"pivot":{"x":0,"y":1}},{"members":[{"x":2,"y":0},{"x":1,"y":1},{"x":0,"y":1},{"x":0,"y":2}],"pivot":{"x":1,"y":1}},{"members":[{"x":2,"y":1},{"x":2,"y":0},{"x":1,"y":0},{"x":0,"y":1}],"pivot":{"x":1,"y":0}},{"members":[{"x":1,"y":1},{"x":2,"y":0},{"x":1,"y":0},{"x":0,"y":1}],"pivot":{"x":1,"y":0}},{"members":[{"x":0,"y":0},{"x":0,"y":1},{"x":1,"y":1},{"x":0,"y":2}],"pivot":{"x":0,"y":1}},{"members":[{"x":0,"y":1},{"x":1,"y":1},{"x":3,"y":0},{"x":2,"y":0}],"pivot":{"x":1,"y":0}}],"id":3,"filled":[{"x":2,"y":5},{"x":3,"y":5},{"x":4,"y":5},{"x":5,"y":5},{"x":11,"y":5},{"x":16,"y":5},{"x":17,"y":5},{"x":18,"y":5},{"x":19,"y":5},{"x":25,"y":5},{"x":4,"y":6},{"x":11,"y":6},{"x":18,"y":6},{"x":25,"y":6},{"x":4,"y":7},{"x":11,"y":7},{"x":18,"y":7},{"x":25,"y":7},{"x":4,"y":8},{"x":11,"y":8},{"x":18,"y":8},{"x":25,"y":8},{"x":4,"y":9},{"x":7,"y":9},{"x":8,"y":9},{"x":11,"y":9},{"x":18,"y":9},{"x":21,"y":9},{"x":22,"y":9},{"x":25,"y":9},{"x":4,"y":10},{"x":7,"y":10},{"x":9,"y":10},{"x":18,"y":10},{"x":21,"y":10},{"x":23,"y":10},{"x":2,"y":11},{"x":3,"y":11},{"x":4,"y":11},{"x":5,"y":11},{"x":7,"y":11},{"x":8,"y":11},{"x":9,"y":11},{"x":11,"y":11},{"x":16,"y":11},{"x":17,"y":11},{"x":18,"y":11},{"x":19,"y":11},{"x":21,"y":11},{"x":22,"y":11},{"x":23,"y":11},{"x":25,"y":11}],"sourceLength":100}';
//p1
//var problem = '{"height":15,"width":15,"sourceSeeds":[0],"units":[{"members":[{"x":0,"y":0}],"pivot":{"x":0,"y":0}}],"id":1,"filled":[{"x":2,"y":4},{"x":3,"y":4},{"x":4,"y":4},{"x":5,"y":4},{"x":6,"y":4},{"x":11,"y":4},{"x":2,"y":5},{"x":8,"y":5},{"x":11,"y":5},{"x":2,"y":6},{"x":11,"y":6},{"x":2,"y":7},{"x":3,"y":7},{"x":4,"y":7},{"x":8,"y":7},{"x":11,"y":7},{"x":2,"y":8},{"x":9,"y":8},{"x":11,"y":8},{"x":2,"y":9},{"x":8,"y":9},{"x":2,"y":10},{"x":3,"y":10},{"x":4,"y":10},{"x":5,"y":10},{"x":6,"y":10},{"x":9,"y":10},{"x":11,"y":10}],"sourceLength":100}';
//p0
//var problem = '{"height":10,"width":10,"sourceSeeds":[0],"units":[{"members":[{"x":0,"y":0}],"pivot":{"x":0,"y":0}},{"members":[{"x":0,"y":0},{"x":2,"y":0}],"pivot":{"x":1,"y":0}},{"members":[{"x":0,"y":0},{"x":0,"y":2}],"pivot":{"x":0,"y":1}},{"members":[{"x":2,"y":0},{"x":0,"y":1},{"x":2,"y":2}],"pivot":{"x":1,"y":1}},{"members":[{"x":0,"y":0},{"x":1,"y":1},{"x":0,"y":2}],"pivot":{"x":0,"y":1}},{"members":[{"x":0,"y":0},{"x":1,"y":0}],"pivot":{"x":0,"y":0}},{"members":[{"x":0,"y":0},{"x":1,"y":0}],"pivot":{"x":1,"y":0}},{"members":[{"x":0,"y":0},{"x":0,"y":1}],"pivot":{"x":0,"y":0}},{"members":[{"x":0,"y":0},{"x":0,"y":1}],"pivot":{"x":0,"y":1}},{"members":[{"x":0,"y":0},{"x":1,"y":0},{"x":2,"y":0}],"pivot":{"x":0,"y":0}},{"members":[{"x":0,"y":0},{"x":1,"y":0},{"x":2,"y":0}],"pivot":{"x":1,"y":0}},{"members":[{"x":0,"y":0},{"x":1,"y":0},{"x":2,"y":0}],"pivot":{"x":2,"y":0}},{"members":[{"x":0,"y":0},{"x":0,"y":1},{"x":0,"y":2}],"pivot":{"x":0,"y":0}},{"members":[{"x":0,"y":0},{"x":0,"y":1},{"x":0,"y":2}],"pivot":{"x":0,"y":1}},{"members":[{"x":0,"y":0},{"x":0,"y":1},{"x":0,"y":2}],"pivot":{"x":0,"y":2}},{"members":[{"x":1,"y":0},{"x":0,"y":1},{"x":1,"y":2}],"pivot":{"x":1,"y":0}},{"members":[{"x":1,"y":0},{"x":0,"y":1},{"x":1,"y":2}],"pivot":{"x":1,"y":1}},{"members":[{"x":1,"y":0},{"x":0,"y":1},{"x":1,"y":2}],"pivot":{"x":1,"y":2}}],"id":0,"filled":[],"sourceLength":100}';

var field_w = 0;
var field_h = 0;

var draw_movement = false;
var draw_landing = false;

//var pivot = { x: 2, y: 3 };
//var filled = [{ x: 2, y: 19}, { x: 3, y: 19}, { x: 3, y: 18}, { x: 6, y: 19}, { x: 5, y: 19} ];
//var members = [{ x: 3, y: 3}, { x: 1, y: 3} ];

var filled = [];
var units = [];

//for landing
var landed_units = [];

//for movement
var current_pivot = 0;
var pivot = undefined;
var members = [];
var commands = [];

/**********************************************CONTROLS****************************************************/
function DoStep(){
	
}

function RefreshCommands(){
	
}

function SendProblem(){
	return function(){
		
		var p = JSON.parse(problem);
		console.log(p);
		
		field_w = p.width;
		field_h = p.height;
		
		filled = p.filled;
		units = p.units;
		
		current_pivot = 1;
		pivot = units[current_pivot].pivot;
		members = units[current_pivot].members;
		commands = [""];
		
		draw_movement = true;
		draw_landing = false;
		
		
		/*var myJSObject = {data : 1}
		$.ajax
		({
			type : 'POST',
			url : 'test.php',
			data : JSON.stringify(myJSObject),
			contentType : 'application/json',
			
			success: function (data) {
				console.log( data ); 
			}
		});*/
		
		/*$.post( "test.php", { param : "test" }, function( data ) {
			console.log( data );
		}, "json");*/
	}
}



/**********************************************INIT****************************************************/
$(function() {
	InitGraphic();
	
	$("#problem_btn").click(SendProblem());
});